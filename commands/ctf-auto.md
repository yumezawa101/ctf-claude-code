# /ctf-auto - 対話式CTFソルバー

問題取得から回答提出まで、対話形式で設定して自動化。

## 使用法

```
/ctf-auto
```

引数なしで起動すると、対話形式で設定を聞きます。

## 対話フロー

```
/ctf-auto

┌─────────────────────────────────────────────────────────┐
│ CTF Auto Solver - 設定                                   │
├─────────────────────────────────────────────────────────┤
│                                                          │
│ [1] プラットフォームURL                                   │
│     > https://ctf.example.com                            │
│     (空欄: problems.jsonを使用)                          │
│                                                          │
│ [2] ログイン情報（URLを入力した場合）                      │
│     ユーザー名 > admin                                    │
│     パスワード > ********                                 │
│                                                          │
│ [3] カテゴリ絞り込み                                      │
│     > web,crypto                                          │
│     (空欄: 全カテゴリ)                                    │
│                                                          │
│ [4] 解きたい問題                                          │
│     > Login Bypass, RSA Easy                             │
│     (空欄: 全問題)                                        │
│                                                          │
│ [5] 配点フィルタ                                          │
│     最小 > 100                                            │
│     最大 > 300                                            │
│     (空欄: 制限なし)                                      │
│                                                          │
│ [6] フラグ自動提出                                        │
│     > y                                                   │
│     (y/N)                                                 │
│                                                          │
└─────────────────────────────────────────────────────────┘

設定完了。実行を開始します...
```

## 設定項目

| 項目 | 説明 | デフォルト |
|------|------|-----------|
| URL | CTFプラットフォームのURL | problems.json使用 |
| ユーザー名 | ログイン用 | - |
| パスワード | ログイン用 | - |
| カテゴリ | web,crypto,forensics,pwn,osint | 全て |
| 問題名 | カンマ区切りで指定 | 全て |
| 最小配点 | この配点以上の問題のみ | 0 |
| 最大配点 | この配点以下の問題のみ | ∞ |
| 自動提出 | フラグを自動でsubmit | No |

## 実行フロー

```
┌─────────────────────────────────────────────────────────┐
│ 1. 問題取得                                              │
│    - URL指定時: Playwright MCPでスクレイピング           │
│    - URL未指定: problems.json から読み込み               │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ 2. フィルタリング & キュー作成                           │
│    - カテゴリ / 問題名 / 配点 で絞り込み                 │
│    - 配点順（低→高）でキューに追加                       │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ 3. キューベース並列解析（重要）                          │
│                                                          │
│    問題キュー: [P1, P2, P3, P4, P5, P6, ...]             │
│                                                          │
│    ┌─────────────────────────────────────────────┐       │
│    │ Agent1 ─→ P1 ─→ Done ─→ P6 ─→ ...          │       │
│    │ Agent2 ─→ P2 ─→ Done ─→ P7 ─→ ...          │       │
│    │ Agent3 ─→ P3 ─→ Timeout ─→ P8 ─→ ...       │       │
│    │ Agent4 ─→ P4 ─→ Done ─→ P9 ─→ ...          │       │
│    │ Agent5 ─→ P5 ─→ (running...)               │       │
│    └─────────────────────────────────────────────┘       │
│                                                          │
│    ✅ 完了したエージェントは待たずに次の問題へ           │
│    ✅ 5分タイムアウトで自動スキップ                      │
│    ❌ バッチ単位で待機しない                             │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ 4. Writeup生成（バックグラウンド）                       │
│    - 各問題解決後、即座にWriteup生成開始                 │
│    - 他の問題解決を待たない                              │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ 5. フラグ提出（自動提出=yの場合）                        │
│    - Playwrightで自動入力・送信                          │
│    - 解決した問題から順次提出（バッチ待ちしない）        │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ 6. 結果レポート                                          │
│    - 解決/未解決/タイムアウト/スキップ一覧               │
│    - 獲得ポイント                                        │
└─────────────────────────────────────────────────────────┘
```

## 5分タイムアウト強制

```
┌──────────────────────────────────────────────────────────┐
│ 各エージェントの動作                                      │
│                                                           │
│  0分 ─────────── 4分 ──────── 5分                        │
│   │              │            │                          │
│   │  通常解析    │ 警告:残1分  │ 強制終了                │
│   │              │            │                          │
│   │              │  進展あり?  │                          │
│   │              │  ├─ Yes → +2分延長可                  │
│   │              │  └─ No  → 終了準備                    │
│                                                           │
│ タイムアウト時:                                           │
│   1. 現在の状態を保存                                     │
│   2. status: "timeout" に更新                             │
│   3. 即座に次の問題へ（他エージェントを待たない）         │
└──────────────────────────────────────────────────────────┘
```

## 禁止事項（速度低下防止）

- ❌ `make`, `cmake`, `cargo build` 等の長時間ビルド
- ❌ 全エージェント完了まで待機（バッチ待ち）
- ❌ 大きなファイルのダウンロード中に他作業をブロック

→ 代替手法を優先し、不可能ならスキップ

## 対応プラットフォーム

| プラットフォーム | 自動取得 | 自動提出 |
|-----------------|---------|---------|
| CTFd           | ✓       | ✓       |
| rCTF           | ✓       | ✓       |
| picoCTF        | ✓       | ✓       |
| カスタム        | 要設定   | 要設定   |

## problems.json の形式

URLを使わない場合、`problems.json` を作成：

```json
{
  "contest": "CTF大会名",
  "problems": [
    {"name": "Login Bypass", "category": "web", "points": 100, "url": "http://..."},
    {"name": "RSA Easy", "category": "crypto", "points": 100, "file": "rsa.txt"},
    {"name": "Hidden Flag", "category": "forensics", "points": 150, "file": "image.png"}
  ]
}
```

## 使用例

### 全自動（URL指定）

```
/ctf-auto
> URL: https://ctf.example.com
> ユーザー名: myteam
> パスワード: ****
> カテゴリ: (空欄)
> 問題: (空欄)
> 最小配点: (空欄)
> 最大配点: (空欄)
> 自動提出: y
```

### 特定カテゴリのみ

```
/ctf-auto
> URL: (空欄)
> カテゴリ: web,crypto
> 問題: (空欄)
> 自動提出: n
```

### 特定の問題だけ

```
/ctf-auto
> URL: (空欄)
> カテゴリ: (空欄)
> 問題: Login Bypass, Hidden Flag
> 自動提出: n
```
